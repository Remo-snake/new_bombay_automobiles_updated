{% extends 'base.html' %}
{% block title %}Staff Attendance{% endblock %}

{% block content %}
<div class="container-fluid p-3">

<h4 class="mb-3">Staff Monthly Attendance</h4>

<!-- FILTER FORM -->
<form method="get" class="row g-2 mb-4">
  <div class="col-md-4">
    <label class="fw-bold">Staff</label>
    <select name="staff" class="form-control" required>
      <option value="">-- Select Staff --</option>
      {% for s in staff_list %}
      <option value="{{ s.id }}"
        {% if selected_staff == s.id|stringformat:"s" %}selected{% endif %}>
        {{ s.user.username }}
      </option>
      {% endfor %}
    </select>
  </div>

  <div class="col-md-4">
    <label class="fw-bold">Month</label>
    <input type="month" name="month"
           class="form-control"
           value="{{ selected_month }}"
           required>
  </div>

  <div class="col-md-2 d-flex align-items-end">
    <button class="btn btn-primary w-100">
      View
    </button>
  </div>
</form>

{% if summary %}
<!-- SUMMARY -->
<div class="row mb-3">
  <div class="col-md-3">
    <div class="card text-center p-2 bg-success text-white">
      <h6>Present</h6>
      <h4>{{ summary.present }}</h4>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center p-2 bg-warning">
      <h6>Half Day</h6>
      <h4>{{ summary.half }}</h4>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center p-2 bg-danger text-white">
      <h6>Absent</h6>
      <h4>{{ summary.absent }}</h4>
    </div>
  </div>
  <div class="col-md-3">
    <div class="card text-center p-2 bg-info text-white">
      <h6>Total Records</h6>
      <h4>{{ summary.total }}</h4>
    </div>
  </div>
</div>

<!-- ATTENDANCE TABLE -->
<div class="card p-3">
  <h5 class="mb-3">
    {{ summary.staff.user.username }} â€“
    {{ summary.month }}/{{ summary.year }}
  </h5>

  <div class="table-responsive">
    <table class="table table-bordered">
      <thead class="table-light">
        <tr>
          <th>Date</th>
          <th>Day</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody>
        {% for a in attendance_list %}
        <tr>
          <td>{{ a.date|date:"d-m-Y" }}</td>
          <td>{{ a.date|date:"l" }}</td>
          <td>
            {% if a.status == 'P' %}
              <span class="badge bg-success">Present</span>
            {% elif a.status == 'H' %}
              <span class="badge bg-warning text-dark">Half Day</span>
            {% else %}
              <span class="badge bg-danger">Absent</span>
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-center text-muted">
            No attendance records
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

</div>
{% endblock %}
