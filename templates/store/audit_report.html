{% extends 'base.html' %}
{% load humanize %}

{% block title %}Audit Report{% endblock %}

{% block content %}
<div class="container-fluid p-4">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>üìä Audit Report</h4>

    <div>
      <a href="{% url 'audit_export_pdf' %}?start={{ start_date }}&end={{ end_date }}"
         class="btn btn-danger btn-sm">
        Export PDF
      </a>

      <a href="{% url 'audit_export_excel' %}?start={{ start_date }}&end={{ end_date }}"
         class="btn btn-success btn-sm">
        Export Excel
      </a>
    </div>
  </div>

  <!-- FILTER -->
  <form class="row g-2 mb-4">
    <div class="col-md-3">
  <input type="date" name="start" value="{{ start_date }}"
         class="form-control" style="border: 1px solid #000;">
</div>

<div class="col-md-3">
  <input type="date" name="end" value="{{ end_date }}"
         class="form-control" style="border: 1px solid #000;">
</div>

    <div class="col-md-2">
      <button class="btn btn-primary w-100">Filter</button>
    </div>
  </form>

  <!-- SUMMARY -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-center shadow">
        <div class="card-body">
          <h6>Total Revenue</h6>
          <h4 class="text-success">‚Çπ {{ total_sales|intcomma }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card text-center shadow">
        <div class="card-body">
          <h6>Total Purchases</h6>
          <h4 class="text-danger">‚Çπ {{ total_purchases|intcomma }}</h4>
        </div>
      </div>
    </div>

    <div class="col-md-4">
      <div class="card text-center shadow">
        <div class="card-body">
          <h6>Net Profit</h6>
          <h4 class="{% if net_profit >= 0 %}text-success{% else %}text-danger{% endif %}">
            ‚Çπ {{ net_profit|intcomma }}
          </h4>
        </div>
      </div>
    </div>
  </div>

  <!-- STAFF CONTRIBUTION -->
  <div class="card mb-4">
    <div class="card-header fw-bold">üë®‚Äçüîß Staff Contribution</div>
    <table class="table table-striped mb-0">
      <thead>
        <tr>
          <th>Staff</th>
          <th>Role</th>
          <th>Total Sales</th>
        </tr>
      </thead>
      <tbody>
        {% for s in staff_sales %}
        <tr>
          <td>{{ s.attended_staff__user__username }}</td>
          <td>{{ s.attended_staff__role }}</td>
          <td>‚Çπ {{ s.total|intcomma }}</td>
        </tr>
        {% empty %}
        <tr>
          <td colspan="3" class="text-center">No data</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
