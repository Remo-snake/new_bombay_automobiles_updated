{% extends "base.html" %}
{% block title %}Dealers{% endblock %}

{% block content %}
<div class="container-fluid p-4">

  <!-- Header -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h4>Dealers</h4>

    <a href="{% url 'dealer_create' %}" class="btn btn-primary">
      + Add Dealer
    </a>
  </div>

  <!-- Search -->
  <input type="text"
         id="dealerSearch"
         class="form-control w-100 mb-3"
         placeholder="Search dealer...">

  {% if messages %}
    {% for m in messages %}
      <div class="alert alert-{{ m.tags }}">{{ m }}</div>
    {% endfor %}
  {% endif %}

  <!-- Table -->
  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>GST</th>
            <th>Address</th>
            <th width="80" class="text-center">Action</th>
          </tr>
        </thead>

        <tbody>
          {% for d in dealers %}
          <tr>

            <!-- IMPORTANT: dealer-name class -->
            <td class="dealer-name fw-bold">
              {{ d.name }}
            </td>

            <td>{{ d.phone|default:"‚Äî" }}</td>
            <td>{{ d.gst_number|default:"‚Äî" }}</td>
            <td>{{ d.address|truncatechars:30|default:"‚Äî" }}</td>

            <!-- Action Dropdown -->
            <td class="text-center">
              <div class="dropdown">
                <button class="btn btn-sm btn-light border-0"
                        data-bs-toggle="dropdown"
                        aria-expanded="false">
                  ‚ãÆ
                </button>

                <ul class="dropdown-menu dropdown-menu-end">
                  <li>
                    <a class="dropdown-item"
                       href="{% url 'dealer_update' d.id %}">
                      ‚úèÔ∏è Edit
                    </a>
                  </li>
                  <li>
                    <a class="dropdown-item text-danger"
                       href="{% url 'dealer_delete' d.id %}"
                       onclick="return confirm('Delete this dealer?');">
                      üóëÔ∏è Delete
                    </a>
                  </li>
                </ul>
              </div>
            </td>

          </tr>
          {% empty %}
          <tr>
            <td colspan="5" class="text-center text-muted py-4">
              No dealers found
            </td>
          </tr>
          {% endfor %}
        </tbody>

      </table>
    </div>
  </div>

</div>

<!-- ======================
     SEARCH SCRIPT
====================== -->
<script>
document.getElementById("dealerSearch").addEventListener("keyup", function () {
  const search = this.value.toLowerCase();
  const rows = document.querySelectorAll("tbody tr");

  rows.forEach(row => {
    const dealer =
      row.querySelector(".dealer-name")?.innerText.toLowerCase() || "";

    row.style.display = dealer.includes(search) ? "" : "none";
  });
});
</script>

{% endblock %}
