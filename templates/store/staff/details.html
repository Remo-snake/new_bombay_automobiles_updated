{% extends "base.html" %}
{% load static %}
{% block title %}Staff Details{% endblock %}

{% block content %}
<div class="container-fluid p-4">

  <div class="d-flex justify-content-between mb-3">
    <h4>Staff Details</h4>
    <a href="{% url 'staff_create' %}" class="btn btn-primary">
      + Add Staff
    </a>
  </div>

  <div class="card shadow-sm">
    <div class="table-responsive">
      <table class="table table-hover align-middle mb-0">
        <thead class="table-light">
          <tr>
            <th>Staff</th>
            <th>Role</th>
            <th>Joining Date</th>
            <th>Star</th>
            <th>Salary</th>
            <th class="text-center" width="80">Action</th>
          </tr>
        </thead>

        <tbody>
        {% for s in staff_list %}
        <tr>

          <!-- Staff Info -->
          <td>
            <div class="d-flex align-items-center">
              <img
                src="{% if s.profile_picture %}{{ s.profile_picture }}{% else %}{% static 'profiles/default.png' %}{% endif %}"
                class="rounded-circle me-2 border"
                width="40"
                height="40"
                style="object-fit: cover;"
                alt="Staff Image">

              <strong>{{ s.user.username }}</strong>
            </div>
          </td>

          <td>{{ s.get_role_display }}</td>

          <td>
            {{ s.joining_date|date:"d M Y"|default:"—" }}
          </td>

          <td>
            {% if s.is_star_staff %}⭐{% else %}—{% endif %}
          </td>

          <!-- Salary Info -->
          <td>
            {% if s.salary %}
              ₹ {{ s.salary.monthly_salary }}
              <br>
              <small class="text-muted">
                ₹ {{ s.salary.per_day_salary }} / day
              </small>
            {% else %}
              <span class="badge bg-warning text-dark">
                Not Configured
              </span>
            {% endif %}
          </td>

          <!-- ACTION MENU -->
          <td class="text-center">
            <div class="dropdown">
              <button class="btn btn-sm btn-light" data-bs-toggle="dropdown">
                <i class="fa fa-ellipsis-vertical"></i>
              </button>

              <div class="dropdown-menu dropdown-menu-end p-3"
                   style="min-width: 220px;">

                <!-- SET / UPDATE SALARY -->
                <form method="post"
                      action="{% url 'set_staff_salary' s.id %}">
                  {% csrf_token %}

                  <label class="form-label small">
                    Monthly Salary
                  </label>

                  <input type="number"
                         name="monthly_salary"
                         class="form-control form-control-sm mb-2"
                         placeholder="Enter salary"
                         step="0.01"
                         required>

                  <button class="btn btn-sm btn-success w-100">
                    Save Salary
                  </button>
                </form>

                <hr class="my-2">

                <!-- ACTIONS -->
                <a class="dropdown-item"
                   href="{% url 'staff_update' s.id %}">
                  <i class="fa fa-pen me-2"></i> Edit
                </a>

                <a class="dropdown-item text-danger"
                   href="{% url 'staff_delete' s.id %}">
                  <i class="fa fa-trash me-2"></i> Delete
                </a>

              </div>
            </div>
          </td>

        </tr>
        {% endfor %}
        </tbody>

      </table>
    </div>
  </div>

</div>
{% endblock %}
